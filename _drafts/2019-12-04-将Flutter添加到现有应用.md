---
title: å°†Flutteræ·»åŠ åˆ°ç°æœ‰åº”ç”¨
layout: post
category: blog
tag:
- other
---

# å°†Flutteræ·»åŠ åˆ°ç°æœ‰åº”ç”¨

Jenn Magderç¼–è¾‘äº†æ­¤é¡µé¢ 20å¤©å‰ Â· [99ä¸ªä¿®è®¢](https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps/_history)

## ä»‹ç»

è½»æ¾å°†Flutteræ·»åŠ åˆ°ç°æœ‰åº”ç”¨ç¨‹åºçš„å·¥ä½œæ­£åœ¨è¿›è¡Œä¸­ã€‚

è¯¥é¡µé¢è®°å½•äº†è¯¥å·¥ä½œçš„å½“å‰çŠ¶æ€ï¼Œå¹¶å°†åœ¨æˆ‘ä»¬æ„å»ºå¿…è¦çš„å·¥å…·æ—¶è¿›è¡Œæ›´æ–°ã€‚

æœ€åæ›´æ–°æ—¶é—´ä¸º2019å¹´8æœˆ23æ—¥ã€‚

â€œæ·»åŠ åˆ°åº”ç”¨â€æ”¯æŒ**å¤„äºé¢„è§ˆçŠ¶æ€**ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ä»…åœ¨ä¸»é¢‘é“ä¸Šå¯ç”¨ã€‚

## å…è´£å£°æ˜

ç”±äºFlutterçš„â€œæ·»åŠ åˆ°åº”ç”¨â€åŠŸèƒ½å¤„äºé¢„è§ˆçŠ¶æ€ï¼Œå› æ­¤ç›¸å…³çš„APIå’Œå·¥å…·ä¸ç¨³å®šï¼Œå¹¶ä¸”å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚

## Flutteræ¨¡å—é¡¹ç›®æ¨¡æ¿

ä½¿ç”¨åˆ›å»ºçš„Flutteré¡¹ç›®`flutter create xxx`åŒ…æ‹¬ç”¨äºFlutter / Dartä»£ç çš„éå¸¸ç®€å•çš„å®¿ä¸»åº”ç”¨ç¨‹åºï¼ˆå•ä¸ªActivity Androidå®¿ä¸»å’Œå•ä¸ªViewController iOSå®¿ä¸»ï¼‰ã€‚æ‚¨å¯ä»¥ä¿®æ”¹è¿™äº›ä¸»æœºåº”ç”¨ç¨‹åºä»¥é€‚åˆæ‚¨çš„éœ€æ±‚å¹¶ä»é‚£é‡Œæ„å»ºã€‚

ä½†æ˜¯ï¼Œå¦‚æœæ‚¨è¦ä»ä»»ä¸€å¹³å°çš„*ç°æœ‰*ä¸»æœºåº”ç”¨ç¨‹åºå¼€å§‹ï¼Œåˆ™å¯èƒ½éœ€è¦å°†Flutteré¡¹ç›®ä½œä¸ºæŸç§å½¢å¼çš„åº“åŒ…å«åœ¨è¯¥åº”ç”¨ç¨‹åºä¸­ã€‚

è¿™å°±æ˜¯Flutteræ¨¡å—æ¨¡æ¿æ‰€æä¾›çš„ã€‚æ‰§è¡Œå°† `flutter create -t module xxx`äº§ç”Ÿä¸€ä¸ªFlutteré¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªAndroidåº“å’Œä¸€ä¸ªCocoaPods Podï¼Œä¾›æ‚¨ç°æœ‰çš„å®¿ä¸»åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚

## å®‰å“ç³»ç»Ÿ

### åˆ›å»ºFlutteræ¨¡å—

å‡è®¾æ‚¨åœ¨å¤„å·²æœ‰ä¸€ä¸ªAndroidåº”ç”¨`some/path/MyApp`ï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›Flutteré¡¹ç›®ä½œä¸ºåŒçº§é¡¹ç›®ï¼š

```sh
$ cd some/path/
$ flutter create -t module --org com.example my_flutter
```

è¿™å°†åˆ›å»ºä¸€ä¸ª`some/path/my_flutter/`Flutteræ¨¡å—é¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›Dartä»£ç ä»¥å¸®åŠ©æ‚¨å…¥é—¨ä»¥åŠä¸€ä¸ª`.android/`éšè—çš„å­æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹å°†æ¨¡å—é¡¹ç›®åŒ…è£…åœ¨Androidåº“ä¸­ã€‚

#### ä½¿ç”¨Android Studioåˆ›å»ºFlutteræ¨¡å—

å¦‚æœæ‚¨ä½¿ç”¨Android Studioåˆ›å»ºæ–°çš„Flutteræ¨¡å—ï¼Œåˆ™å¯ä»¥è·³è¿‡ä¸€äº›æ‰‹åŠ¨ç¼–è¾‘æ­¥éª¤ã€‚ä¸ºæ­¤ï¼Œè¯·åœ¨Android Studioä¸­æ‰“å¼€æ‚¨çš„Androidåº”ç”¨ã€‚ä½¿ç”¨èœå•â€œæ–‡ä»¶>æ–°å»º>æ–°å»ºæ¨¡å—...â€åˆ›å»ºFlutteræ¨¡å—ã€‚

å°†æ‰“å¼€â€œæ–°æ¨¡å—å‘å¯¼â€ï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ªé€‰é¡¹é¢æ¿ã€‚å‘ä¸‹æ»šåŠ¨ä»¥æ‰¾åˆ°Flutterçš„é‚£äº›ã€‚é€‰æ‹©æ ‡è®°ä¸ºçš„ä¸€ä¸ª`Flutter Module`ã€‚å•å‡»å¯`Next`è¿›å…¥Flutterçš„æ–°æ¨¡å—å‘å¯¼é¡µé¢ã€‚åƒå¡«å†™Flutteræ¨¡å—é¡¹ç›®ä¸€æ ·å¡«å†™å®ƒä»¬ã€‚

è¯¥æ¨¡å—åˆ›å»ºåï¼Œä½ å¯ä»¥å¼€å§‹ç¼–è¾‘æ‚¨çš„Androidåº”ç”¨ä½¿ç”¨é¢¤æŒ¯æ¨¡å—ï¼ˆè¯·å‚è§[ä½¿ç”¨æ¥è‡ªJavaä»£ç çš„é¢¤æŒ¯æ¨¡å—](https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps#use-the-flutter-module-from-your-java-code)ï¼‰ã€‚

æ‚¨å¯èƒ½éœ€è¦æ›´æ”¹é¡¹ç›®è§†å›¾æ‰èƒ½æŸ¥çœ‹Flutteræ–‡ä»¶ã€‚é¡¹ç›®æ–‡ä»¶é€‰é¡¹æ•ˆæœå¾ˆå¥½ã€‚

æ‚¨å¯ä»¥è·³è¿‡[ä½¿ä¸»æœºåº”ç”¨ç¨‹åºä¾èµ–Flutteræ¨¡å—çš„æ­¥éª¤](https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps#make-the-host-app-depend-on-the-flutter-module)ï¼›Android Studioå·²ä¸ºæ‚¨æ·»åŠ äº†æºä¾èµ–é¡¹ã€‚

åœ¨æ­¤æ”¯æŒä¸­ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›æ•…éšœã€‚ä½¿ç”¨Android Studio 3.5ï¼Œæ¯æ¬¡GradleåŒæ­¥éƒ½ä¼šå¯¼è‡´Flutteræ¨¡å—çš„Dartæ”¯æŒè¢«åˆ é™¤ã€‚æ¯ä¸ªDartæ–‡ä»¶ç¼–è¾‘åœ¨é¡¶éƒ¨éƒ½æœ‰ä¸€ä¸ªæŒ‰é’®å¯ä»¥é‡æ–°å¯ç”¨å®ƒã€‚å¯¹äºAndroid Studio 3.6ï¼Œè¿™ä¸æ˜¯é—®é¢˜ã€‚ä½†æ˜¯ï¼Œåœ¨3.6ä¸­ï¼ŒGradleåŒæ­¥æŠ¥å‘Šäº†è™šå‡é”™è¯¯ã€‚åº”è¯¥å¿½ç•¥å®ƒã€‚ï¼ˆæˆ‘ä»¬æ­£åœ¨å°è¯•æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æ¶ˆé™¤å®ƒã€‚ï¼‰

### ä¸»æœºåº”ç”¨ç¨‹åºè¦æ±‚

åœ¨å°è¯•å°†Flutteræ¨¡å—é¡¹ç›®è¿æ¥åˆ°ä¸»æœºAndroidåº”ç”¨ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ä¸»æœºAndroidåº”ç”¨åœ¨æ‚¨çš„åº”ç”¨`build.gradle`æ–‡ä»¶ä¸­çš„`android { }` å—ä¸‹å£°æ˜äº†ä»¥ä¸‹æºå…¼å®¹æ€§ï¼Œä¾‹å¦‚ï¼š

```
android {
   // ...
  compileOptions {
    sourceCompatibility 1.8 
    targetCompatibility 1.8
  }
}
```

### ä½¿ä¸»æœºåº”ç”¨ç¨‹åºä¾èµ–Flutteræ¨¡å—

æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å®ç°æ­¤ç›®çš„ï¼š

#### 1.å–å†³äºAndroidå­˜æ¡£ï¼ˆAARï¼‰

è¿™ä¼šå°†Flutteråº“æ‰“åŒ…ä¸ºåŒ…å«AARå’ŒPOMå·¥ä»¶çš„é€šç”¨æœ¬åœ°Mavenå­˜å‚¨åº“ã€‚è¿™ä½¿æ‚¨çš„å›¢é˜Ÿæ— éœ€å®‰è£…Flutter SDKå³å¯æ„å»ºä¸»æœºåº”ç”¨ç¨‹åºã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä»æœ¬åœ°æˆ–è¿œç¨‹å­˜å‚¨åº“ä¸­åˆ†å‘å·¥ä»¶ã€‚

å‡è®¾æ‚¨åœ¨æ„å»ºäº†Flutteræ¨¡å—`some/path/my_flutter`ï¼Œç„¶åè¿è¡Œï¼š

```sh
$ cd some/path/my_flutter
$ flutter build aar
```

æ­¤å‘½ä»¤ï¼ˆé»˜è®¤ä¸ºå‘å¸ƒæ¨¡å¼ï¼‰ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶åˆ›å»º[æœ¬åœ°å­˜å‚¨åº“](https://docs.gradle.org/current/userguide/repository_types.html#sub:maven_local)ï¼š

```
build/host/outputs/repo
â””â”€â”€ com
    â””â”€â”€ example
        â””â”€â”€ my_flutter
            â””â”€â”€ flutter_release
                â”œâ”€â”€ 1.0
                â”‚   â”œâ”€â”€ flutter_release-1.0.aar
                â”‚   â”œâ”€â”€ flutter_release-1.0.aar.md5
                â”‚   â”œâ”€â”€ flutter_release-1.0.aar.sha1
                â”‚   â”œâ”€â”€ flutter_release-1.0.pom
                â”‚   â”œâ”€â”€ flutter_release-1.0.pom.md5
                â”‚   â””â”€â”€ flutter_release-1.0.pom.sha1
                â”œâ”€â”€ maven-metadata.xml
                â”œâ”€â”€ maven-metadata.xml.md5
                â””â”€â”€ maven-metadata.xml.sha1
```

è¦ä¾èµ–AARï¼Œä¸»æœºåº”ç”¨å¿…é¡»èƒ½å¤Ÿæ‰¾åˆ°è¿™äº›æ–‡ä»¶ã€‚

ä¸ºæ­¤ï¼Œè¯·`app/build.gradle`åœ¨æ‚¨çš„ä¸»æœºåº”ç”¨ç¨‹åºä¸­è¿›è¡Œç¼–è¾‘ï¼Œä¾‹å¦‚å®ƒåŒ…æ‹¬æœ¬åœ°å­˜å‚¨åº“å’Œä¾èµ–é¡¹ï¼š

```
// MyApp/app/build.gradle

android {
  // ...
}

repositories {
  maven {
    url 'some/path/my_flutter/build/host/outputs/repo'
    // This is relative to the location of the build.gradle file 
    // if using a relative path. 
  }
}

dependencies {
  // ...
  releaseCompile ('com.example.my_flutter:flutter_release:1.0@aar') {
    transitive = true
  }
}
```

æ‚¨è¿˜å¯ä»¥é€šè¿‡è¿è¡Œ`flutter build aar --debug` ç„¶ååœ¨å®¿ä¸»åº”ç”¨ç¨‹åºä¸­æ·»åŠ ä¾èµ–é¡¹æ¥æ„å»ºè°ƒè¯•å˜é‡ï¼š

```
// MyApp/app/build.gradle

dependencies {
  // ...
  debugCompile ('com.example.my_flutter:flutter_debug:1.0@aar') {
    transitive = true
  }
}
```

#### 2.å–å†³äºæ¨¡å—çš„æºä»£ç 

è¿™å°†ä¸ºæ‚¨çš„Androidé¡¹ç›®å’ŒFlutteré¡¹ç›®å¯ç”¨ä¸€ä¸ªæ­¥éª¤çš„æ„å»ºã€‚å½“åŒæ—¶å¤„ç†ä¸¤ä¸ªéƒ¨åˆ†æ—¶ï¼Œè¿™å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯æ‚¨çš„å›¢é˜Ÿå¿…é¡»å®‰è£…Flutter SDKæ‰èƒ½æ„å»ºä¸»æœºåº”ç”¨ç¨‹åºã€‚

å°†Flutteræ¨¡å—ä½œä¸ºå­é¡¹ç›®åŒ…å«åœ¨ä¸»æœºåº”ç”¨ç¨‹åºçš„ä¸­`settings.gradle`ï¼š

```ruby
// MyApp/settings.gradle
include ':app'                                     // assumed existing content
setBinding(new Binding([gradle: this]))                                 // new
evaluate(new File(                                                      // new
  settingsDir.parentFile,                                               // new
  'my_flutter/.android/include_flutter.groovy'                          // new
)) 
```

ç»“åˆå’Œè„šæœ¬è¯„ä¼°å…è®¸æ‰‘æ¨¡å—`include`æœ¬èº«ï¼ˆå¦‚`:flutter`ï¼‰å’Œæ¨¡å—ä½¿ç”¨ä»»ä½•æ’ä»¶æ‰‘ï¼ˆå¦‚`:package_info`ï¼Œ `:video_player`åœ¨ä½ çš„è¯„ä»·æ–¹é¢ï¼Œç­‰ç­‰ï¼‰`settings.gradle`ã€‚

`implementation`ä»æ‚¨çš„åº”ç”¨ç¨‹åºå¼•å…¥å¯¹Flutteræ¨¡å—çš„ä¾èµ–ï¼š

```
// MyApp/app/build.gradle

dependencies {
  implementation project(':flutter')
}
```

### ä½¿ç”¨Javaä»£ç ä¸­çš„Flutteræ¨¡å—

#### Flutterçš„æ–°AndroidåµŒå…¥

å¦‚æœæ‚¨æ˜¯æ¥è¿™é‡Œå¯»æ‰¾Flutterçš„æ–°AndroidåµŒå…¥ä¿¡æ¯çš„ï¼Œè¯·å‚é˜…[ä¸“ç”¨äºæ–°åµŒå…¥çš„é¡µé¢](https://github.com/flutter/flutter/wiki/Adding-Flutter-to-Android)ã€‚

æœ¬æŒ‡å—æŒ‡çš„æ˜¯`io.flutter.facade.*`ä¾‹å¦‚ä¸‹çš„ç±»çš„ç”¨æ³•`io.flutter.facade.FlutterFragment`ã€‚è¿™äº›ç±»æ­£åœ¨è¢«å¼ƒç”¨ã€‚ä¸æ¨èä½¿ç”¨çš„`io.flutter.facade.FlutterFragment`å°†ç”±è¾ƒæ–°çš„ä»£æ›¿`io.flutter.embedding.android.FlutterFragment`ã€‚ç”±äºçš„ä¸¤ä¸ªç‰ˆæœ¬`FlutterFragment`éƒ½å¤„äºæŠ€æœ¯é¢„è§ˆç‰ˆä¸­ï¼Œå¹¶ä¸”ä¸¤ä¸ªç‰ˆæœ¬éƒ½ä¸æ˜¯APIç¨³å®šçš„ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®ä½¿ç”¨[æ–°çš„FlutterFragment](https://github.com/flutter/flutter/wiki/Experimental:-Add-Flutter-Fragment)ã€‚

### ç”Ÿæˆå¹¶è¿è¡Œæ‚¨çš„åº”ç”¨

ç”Ÿæˆå’Œè¿è¡Œ`MyApp`çš„æ–¹å¼ä¸æ·»åŠ Flutteræ¨¡å—ä¾èµ–é¡¹ä¹‹å‰çš„æ–¹å¼å®Œå…¨ç›¸åŒï¼Œé€šå¸¸ä½¿ç”¨Android Studioã€‚ç¼–è¾‘ï¼Œè°ƒè¯•å’Œåˆ†æAndroidä»£ç ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

### çƒ­é‡å¯/é‡æ–°åŠ è½½å’Œè°ƒè¯•Dartä»£ç 

æ­£åœ¨è¿›è¡Œå…¨é¢çš„IDEé›†æˆä»¥æ”¯æŒä¸æ··åˆåº”ç”¨ç¨‹åºçš„Flutter / Dartä»£ç ä¸€èµ·ä½¿ç”¨ã€‚ä½†æ˜¯åŸºæœ¬åŸç†å·²ç»é€šè¿‡Flutterå‘½ä»¤è¡Œå·¥å…·å’ŒDart Observatory Webç”¨æˆ·ç•Œé¢æä¾›ã€‚

è¿æ¥è®¾å¤‡æˆ–å¯åŠ¨ä»¿çœŸå™¨ã€‚ç„¶åä½¿Flutter CLIå·¥å…·ç›‘å¬æ‚¨çš„åº”ç”¨ç¨‹åºï¼š

```sh
$ cd some/path/my_flutter
$ flutter attach
Waiting for a connection from Flutter on Nexus 5X...
```

`MyApp`ä»Android Studioä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨ï¼ˆæˆ–é€šå¸¸é‡‡ç”¨çš„ä»»ä½•ä¸€ç§æ–¹å¼ï¼‰ã€‚å¯¼èˆªåˆ°ä½¿ç”¨Flutterçš„åº”ç”¨ç¨‹åºåŒºåŸŸã€‚ç„¶åå›åˆ°ç»ˆç«¯ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š

```
Done.
Syncing files to device Nexus 5X...                          5.1s

ğŸ”¥  To hot reload changes while running, press "r". To hot restart (and rebuild state), press "R".
An Observatory debugger and profiler on Nexus 5X is available at: http://127.0.0.1:59556/
For a more detailed help message, press "h". To quit, press "q".
```

ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨ä¸­ç¼–è¾‘Dartä»£ç `my_flutter`ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡`r`åœ¨ç»ˆç«¯ä¸­æŒ‰æ¥é‡æ–°åŠ è½½æ›´æ”¹ã€‚æ‚¨ä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„URLç²˜è´´åˆ°æµè§ˆå™¨ä¸­ï¼Œä»¥ä½¿ç”¨Dart Observatoryè®¾ç½®æ–­ç‚¹ï¼Œåˆ†æå†…å­˜ä¿ç•™å’Œå…¶ä»–è°ƒè¯•ä»»åŠ¡ã€‚

å¦‚æœæ‚¨å¸Œæœ›ä¸ºåº”ç”¨ç¨‹åºæŒ‡å®šç«¯å£å·å’Œ/æˆ–ç¦ç”¨èº«ä»½éªŒè¯ä»£ç ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ„å›¾æ ‡å¿—æ¥å®ç°ï¼Œä¾‹å¦‚

```
--ei observatory-port 12345 --eb disable-service-auth-codes
```

å¯ä»¥é€šè¿‡åœ¨[Android Studioä¸­`Launch Flags`](https://developer.android.com/studio/run/rundebugconfig#opening)è¾“å…¥è¿™äº›å†…å®¹ã€‚

## iOS

### åˆ›å»ºFlutteræ¨¡å—

å‡è®¾æ‚¨åœ¨å¤„æœ‰ä¸€ä¸ªç°æœ‰çš„iOSåº”ç”¨`some/path/MyApp`ï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›Flutteré¡¹ç›®ä½œä¸ºåŒçº§é¡¹ç›®ï¼š

```sh
$ cd some/path/
$ flutter create -t module my_flutter
```

è¿™å°†åˆ›å»ºä¸€ä¸ª`some/path/my_flutter/`Flutteræ¨¡å—é¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›Dartä»£ç ä»¥å¸®åŠ©æ‚¨å…¥é—¨ä»¥åŠä¸€ä¸ª`.ios/`éšè—çš„å­æ–‡ä»¶å¤¹ï¼Œè¯¥å­æ–‡ä»¶å¤¹åŒ…è£…äº†åŒ…å«ä¸€äº›Cocoapodså’Œä¸€ä¸ªè¾…åŠ©Rubyè„šæœ¬çš„æ¨¡å—é¡¹ç›®ã€‚

### ä½¿ä¸»æœºåº”ç”¨ç¨‹åºä¾èµ–Flutteræ¨¡å—

ä¸‹é¢çš„æè¿°å‡å®šæ‚¨ç°æœ‰çš„iOSåº”ç”¨ç¨‹åºå…·æœ‰ä¸è¦æ±‚Xcodeç‰ˆæœ¬10.0ä½¿ç”¨Objective-Cç”Ÿæˆæ–°çš„â€œå•è§†å›¾åº”ç”¨ç¨‹åºâ€é¡¹ç›®æ‰€å¾—åˆ°çš„ç»“æ„ç±»ä¼¼çš„ç»“æ„ã€‚å¦‚æœæ‚¨ç°æœ‰çš„åº”ç”¨ç¨‹åºå…·æœ‰ä¸åŒçš„æ–‡ä»¶å¤¹ç»“æ„å’Œ/æˆ–ç°æœ‰`.xcconfig`æ–‡ä»¶ï¼Œåˆ™å¯ä»¥é‡ç”¨å®ƒä»¬ï¼Œä½†æ˜¯å¯èƒ½éœ€è¦ç›¸åº”åœ°è°ƒæ•´ä¸‹é¢æåˆ°çš„ä¸€äº›ç›¸å¯¹è·¯å¾„ã€‚

å‡å®šçš„æ–‡ä»¶å¤¹ç»“æ„å¦‚ä¸‹ï¼š

```
some/path/
  my_flutter/
    lib/main.dart
    .ios/
  MyApp/
    MyApp/
      AppDelegate.h
      AppDelegate.m (or swift)
      :
```

#### å°†Flutteråº”ç”¨æ·»åŠ åˆ°Podfile

é›†æˆFlutteræ¡†æ¶éœ€è¦ä½¿ç”¨CocoaPodsä¾èµ–å…³ç³»ç®¡ç†å™¨ã€‚è¿™æ˜¯å› ä¸ºFlutteræ¡†æ¶éœ€è¦å¯¹my_flutterä¸­å¯èƒ½åŒ…å«çš„æ‰€æœ‰Flutteræ’ä»¶å¯ç”¨ã€‚

å¦‚æœæ‚¨åœ¨2019å¹´7æœˆ30æ—¥ä¹‹å‰æˆ–ä¹‹å‰å°†Flutteræ·»åŠ åˆ°ç°æœ‰çš„iOSåº”ç”¨ç¨‹åºä¸­ï¼Œ `flutter --version`åˆ™`Flutter 1.8.4-pre.21`å¯èƒ½éœ€è¦ [å‡çº§ç¯å¢ƒ](https://github.com/flutter/flutter/wiki/Upgrading-Flutter-added-to-existing-iOS-Xcode-project)ã€‚åœ¨éµå¾ªè¿ç§»è¯´æ˜ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨ä½äº [ä¸»é¢‘é“ä¸Š](https://github.com/flutter/flutter/wiki/Flutter-build-release-channels)å¹¶å¯ä»¥è¿è¡Œ `flutter upgrade`ã€‚

å¦‚æœéœ€è¦ï¼Œè¯·è®¿é—®[cocoapods.org](https://cocoapods.org/)ï¼Œäº†è§£å¦‚ä½•åœ¨æ‚¨çš„å¼€å‘è®¡ç®—æœºä¸Šå®‰è£…CocoaPodsã€‚

å¦‚æœæ‚¨çš„å®¿ä¸»åº”ç”¨ç¨‹åºï¼ˆ`MyApp`ï¼‰å·²åœ¨ä½¿ç”¨CocoaPodsï¼Œåˆ™åªéœ€æ‰§è¡Œä»¥ä¸‹æ“ä½œå³å¯ä¸æ‚¨çš„`my_flutter`åº”ç”¨ç¨‹åºé›†æˆï¼š

1. å°†ä»¥ä¸‹å‡ è¡Œæ·»åŠ åˆ°æ‚¨çš„`Podfile`ï¼š

```ruby
  flutter_application_path = 'path/to/my_flutter/'
  load File.join(flutter_application_path, '.ios', 'Flutter', 'podhelper.rb')
```

1. å¯¹äºæ¯ä¸ªéœ€è¦åµŒå…¥Flutterçš„Xcode [ç›®æ ‡](https://guides.cocoapods.org/syntax/podfile.html#target)ï¼Œè¯·è°ƒç”¨`install_all_flutter_pods(flutter_application_path)`ã€‚

```ruby
  target 'MyApp' do
    install_all_flutter_pods(flutter_application_path)
  end
  target 'MyAppTests' do
    install_all_flutter_pods(flutter_application_path)
  end
```

1. è¿è¡Œ`pod install`ã€‚

å½“æ‚¨æ›´æ”¹æ‰‘æ’ä»¶çš„ä¾èµ–å…³ç³»`some/path/my_flutter/pubspec.yaml`ï¼Œä½ éœ€è¦è¿è¡Œ`flutter pub get`ä»`some/path/my_flutter`åˆ·æ–°åˆ—è¡¨æ’ä»¶è¯»å–çš„`podhelper.rb`è„šæœ¬ã€‚ç„¶å`pod install`ä»å†æ¬¡ è¿è¡Œ`some/path/MyApp`ã€‚

è¯¥`podhelper.rb`è„šæœ¬å°†ç¡®ä¿æ‚¨çš„æ’ä»¶Flutter.frameworkå’ŒApp.frameworkåµŒå…¥åœ¨æ‚¨çš„é¡¹ç›®ä¸­ã€‚

ç°åœ¨ï¼Œæ‚¨åº”è¯¥å¯ä»¥ä½¿ç”¨æ¥æ„å»ºé¡¹ç›®`âŒ˜B`ã€‚

#### å¼•æ“ç›–ä¸‹

å¦‚æœæ‚¨å‡ºäºæŸç§åŸå› æ‰‹åŠ¨æ‰§è¡Œæ­¤æ“ä½œæˆ–è°ƒè¯•ä¸ºä»€ä¹ˆè¿™äº›æ­¥éª¤æ— æ³•æ‰§è¡Œï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. `Flutter.framework`ï¼ˆå¼•æ“åº“ï¼‰å·²ä¸ºæ‚¨åµŒå…¥åˆ°æ‚¨çš„åº”ç”¨ä¸­ã€‚è¿™å¿…é¡»ä¸å‘è¡Œç‰ˆç±»å‹ï¼ˆè°ƒè¯•/é…ç½®æ–‡ä»¶/å‘è¡Œç‰ˆï¼‰ä»¥åŠåº”ç”¨ç¨‹åºçš„æ¶æ„ï¼ˆarm *ï¼Œx86_64ç­‰ï¼‰ç›¸åŒ¹é…ã€‚CocoaPodså°†å…¶ä½œä¸ºä¾›åº”å•†æ¡†æ¶å¼•å…¥ï¼Œå¹¶ç¡®ä¿å°†å…¶åµŒå…¥åˆ°æœ¬æœºåº”ç”¨ç¨‹åºä¸­ã€‚
2. `App.framework`ï¼ˆæ‚¨çš„Flutteråº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰å·²åµŒå…¥åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚CocoaPodsè¿˜å°†å…¶ä½œä¸ºä¾›åº”å•†æ¡†æ¶å¼•å…¥ï¼Œå¹¶ç¡®ä¿å°†å…¶åµŒå…¥åˆ°æ‚¨çš„æœ¬æœºåº”ç”¨ç¨‹åºä¸­ã€‚
3. ä»»ä½•æ’ä»¶éƒ½å°†ä½œä¸ºCocoaPod Podæ·»åŠ ã€‚ä»ç†è®ºä¸Šè®²ï¼Œä¹Ÿåº”è¯¥å¯ä»¥æ‰‹åŠ¨åˆå¹¶å®ƒä»¬ï¼Œä½†æ˜¯è¿™äº›è¯´æ˜åœ¨æ¯ä¸ªæ’ä»¶çš„podä¾èµ–é¡¹ä¸Šæœ‰æ‰€ä¸åŒã€‚
4. å°†æ„å»ºè„šæœ¬æ·»åŠ åˆ°Podfileç›®æ ‡ä¸­ï¼Œä»¥ç¡®ä¿æ‰€æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸æ–‡ä»¶å¤¹ä¸­å®é™…å­˜åœ¨çš„Dartä»£ç ä¿æŒæœ€æ–°ã€‚å®ƒè¿˜ä½¿ç”¨æ‚¨çš„Xcodeæ„å»ºé…ç½®ï¼ˆDebugï¼ŒProfileï¼ŒReleaseï¼‰æ¥åµŒå…¥åŒ¹é…çš„å‘è¡Œç‰ˆç±»å‹`Flutter.framework`å’Œ`App.framework`ã€‚

### ç¼–å†™ä»£ç ä»¥ä»ä¸»æœºåº”ç”¨ç¨‹åºä½¿ç”¨FlutterViewController

æ­£ç¡®çš„ä½ç½®å°†å–å†³äºæ‚¨çš„ä¸»æœºåº”ç”¨ç¨‹åºã€‚è¿™æ˜¯ä¸€ä¸ªç”±Xcode 10.0ç”Ÿæˆçš„å®¿ä¸»åº”ç”¨ç¨‹åºçš„ç©ºç™½å±å¹•æœ‰æ„ä¹‰çš„ç¤ºä¾‹ã€‚

é¦–å…ˆï¼Œå°†æ‚¨çš„åº”ç”¨ç¨‹åºå§”æ‰˜å£°æ˜ä¸ºçš„å­ç±»`FlutterAppDelegate`ã€‚ç„¶åå®šä¹‰FlutterEngineå±æ€§ï¼Œè¯¥å±æ€§å¯å¸®åŠ©æ‚¨æ³¨å†Œæ²¡æœ‰FlutterViewControllerå®ä¾‹çš„æ’ä»¶ã€‚

åœ¨`AppDelegate.h`ï¼š

```objective-c
@import UIKit;
@import Flutter;

@interface AppDelegate : FlutterAppDelegate
@property (nonatomic,strong) FlutterEngine *flutterEngine;
@end
```

è¿™å¯ä»¥`AppDelegate.m`éå¸¸ç®€å•ï¼Œé™¤éæ‚¨çš„ä¸»æœºåº”ç”¨ç¨‹åºéœ€è¦åœ¨æ­¤å¤„è¦†ç›–å…¶ä»–æ–¹æ³•ï¼š

```objective-c
@import FlutterPluginRegistrant; // Only if you have Flutter Plugins

#import "AppDelegate.h"

@implementation AppDelegate

// This override can be omitted if you do not have any Flutter Plugins.
- (BOOL)application:(UIApplication *)application
    didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  self.flutterEngine = [[FlutterEngine alloc] initWithName:@"io.flutter" project:nil];
  [self.flutterEngine runWithEntrypoint:nil];
  [GeneratedPluginRegistrant registerWithRegistry:self.flutterEngine];
  return [super application:application didFinishLaunchingWithOptions:launchOptions];
}

@end
```

å¦‚æœæ‚¨ä½¿ç”¨Swiftç¼–å†™ä»£ç ï¼Œåˆ™å¯ä»¥åœ¨ä»¥ä¸‹ä»£ç ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œ`AppDelegate.swift`ï¼š

```swift
import UIKit
import Flutter
import FlutterPluginRegistrant // Only if you have Flutter Plugins.

@UIApplicationMain
class AppDelegate: FlutterAppDelegate {
  var flutterEngine : FlutterEngine?;
  // Only if you have Flutter plugins.
  override func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
    self.flutterEngine = FlutterEngine(name: "io.flutter", project: nil);
    self.flutterEngine?.run(withEntrypoint: nil);
    GeneratedPluginRegistrant.register(with: self.flutterEngine);
    return super.application(application, didFinishLaunchingWithOptions: launchOptions);
  }

}
```

<details style="box-sizing: border-box; display: block; margin-top: 0px; margin-bottom: 16px;"><summary style="box-sizing: border-box; display: list-item; cursor: pointer;"><font style="box-sizing: border-box; vertical-align: inherit;"><font style="box-sizing: border-box; vertical-align: inherit;">å¦‚æœåº”ç”¨ç¨‹åºå§”æ‰˜å·²ç»ä»å…¶ä»–åœ°æ–¹ç»§æ‰¿ï¼Œè¯¥æ€ä¹ˆåŠã€‚</font></font></summary></details>

`ViewController.m`ï¼š

```objective-c
#import "AppDelegate.h"
#import "ViewController.h"
@import Flutter;

@implementation ViewController
- (void)viewDidLoad {
    [super viewDidLoad];
    UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
    [button addTarget:self
               action:@selector(handleButtonAction)
     forControlEvents:UIControlEventTouchUpInside];
    [button setTitle:@"Press me" forState:UIControlStateNormal];
    [button setBackgroundColor:[UIColor blueColor]];
    button.frame = CGRectMake(80.0, 210.0, 160.0, 40.0);
    [self.view addSubview:button];
}

- (void)handleButtonAction {
    FlutterEngine *flutterEngine = [(AppDelegate *)[[UIApplication sharedApplication] delegate] flutterEngine];
    FlutterViewController *flutterViewController = [[FlutterViewController alloc] initWithEngine:flutterEngine nibName:nil bundle:nil];
    [self presentViewController:flutterViewController animated:false completion:nil];
}
@end
```

æˆ–è€…ï¼Œä½¿ç”¨Swiftï¼š

`ViewController.swift`ï¼š

```swift
import UIKit
import Flutter

class ViewController: UIViewController {
  override func viewDidLoad() {
    super.viewDidLoad()
    let button = UIButton(type:UIButton.ButtonType.custom)
    button.addTarget(self, action: #selector(handleButtonAction), for: .touchUpInside)
    button.setTitle("Press me", for: UIControl.State.normal)
    button.frame = CGRect(x: 80.0, y: 210.0, width: 160.0, height: 40.0)
    button.backgroundColor = UIColor.blue
    self.view.addSubview(button)
  }

  @objc func handleButtonAction() {
    if let flutterEngine = (UIApplication.shared.delegate as? AppDelegate)?.flutterEngine {
      let flutterViewController = FlutterViewController(engine: flutterEngine, nibName: nil, bundle: nil)
      self.present(flutterViewController, animated: false, completion: nil)
    }
  }
}
```

ç°åœ¨ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨æ¨¡æ‹Ÿå™¨æˆ–è®¾å¤‡ä¸Šæ„å»ºå¹¶å¯åŠ¨MyAppã€‚æŒ‰ä¸‹æŒ‰é’®åº”ä½¿ç”¨æ ‡å‡†Flutter Demoè®¡æ•°åº”ç”¨ç¨‹åºè°ƒå‡ºå…¨å±Flutterè§†å›¾ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è·¯çº¿åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒä½ç½®æ˜¾ç¤ºä¸åŒçš„å°éƒ¨ä»¶ï¼Œå¦‚ä¸Šé¢çš„Androidéƒ¨åˆ†æ‰€è¿°ã€‚è¦è®¾ç½®è·¯çº¿ï¼Œè¯·è‡´ç”µ

- ç›®æ ‡Cï¼š

```objective-c
[flutterViewController setInitialRoute:@"route1"];
```

- è¿…é€Ÿï¼š

```swift
flutterViewController.setInitialRoute("route1")
```

åœ¨æ„å»ºä¹‹å`FlutterViewController`ï¼ˆå¹¶åœ¨å±•ç¤ºä¹‹å‰ï¼‰ã€‚

æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨`SystemNavigator.pop()` Dartä»£ç è®©Flutteråº”ç”¨è‡ªè¡Œå…³é—­ã€‚

### ç”Ÿæˆå¹¶è¿è¡Œæ‚¨çš„åº”ç”¨

æ‚¨ä½¿ç”¨Xcodeæ„å»ºå’Œè¿è¡ŒMyAppçš„æ–¹å¼ä¸æ·»åŠ Flutteræ¨¡å—ä¾èµ–é¡¹ä¹‹å‰çš„æ–¹å¼å®Œå…¨ç›¸åŒã€‚ç¼–è¾‘ï¼Œè°ƒè¯•å’Œåˆ†æiOSä»£ç ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

### çƒ­é‡å¯/é‡æ–°åŠ è½½å’Œè°ƒè¯•Dartä»£ç 

è¿æ¥è®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨ã€‚ç„¶åä½¿Flutter CLIå·¥å…·ç›‘å¬æ‚¨çš„åº”ç”¨ç¨‹åºï¼š

```sh
$ cd some/path/my_flutter
$ flutter attach
Waiting for a connection from Flutter on iPhone X...
```

`MyApp`ä»Xcodeä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨ã€‚å¯¼èˆªåˆ°ä½¿ç”¨Flutterçš„åº”ç”¨ç¨‹åºåŒºåŸŸã€‚ç„¶åå›åˆ°ç»ˆç«¯ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š

```
Done.
Syncing files to device iPhone X...                          4.7s

ğŸ”¥  To hot reload changes while running, press "r". To hot restart (and rebuild state), press "R".
An Observatory debugger and profiler on iPhone X is available at: http://127.0.0.1:54741/
For a more detailed help message, press "h". To quit, press "q".
```

ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨ä¸­ç¼–è¾‘Dartä»£ç `my_flutter`ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡`r`åœ¨ç»ˆç«¯ä¸­æŒ‰æ¥é‡æ–°åŠ è½½æ›´æ”¹ã€‚æ‚¨ä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„URLç²˜è´´åˆ°æµè§ˆå™¨ä¸­ï¼Œä»¥ä½¿ç”¨Dart Observatoryè®¾ç½®æ–­ç‚¹ï¼Œåˆ†æå†…å­˜ä¿ç•™å’Œå…¶ä»–è°ƒè¯•ä»»åŠ¡ã€‚

#### è°ƒè¯•Flutterçš„ç‰¹å®šå®ä¾‹

å¯ä»¥å‘`root isolates`åº”ç”¨ç¨‹åºæ·»åŠ Flutterï¼ˆï¼‰çš„å¤šä¸ªå®ä¾‹ã€‚`flutter attach`é»˜è®¤æƒ…å†µä¸‹è¿æ¥åˆ°æ‰€æœ‰å¯ç”¨çš„éš”ç¦»ã€‚ç„¶åï¼Œå°†ä»é™„åŠ çš„CLIå‘é€çš„æ‰€æœ‰å‘½ä»¤è½¬å‘åˆ°æ¯ä¸ªé™„åŠ çš„éš”ç¦»ã€‚

é€šè¿‡`l`ä»é™„åŠ çš„`flutter`CLIå·¥å…·ä¸­é”®å…¥ï¼Œåˆ—å‡ºæ‰€æœ‰é™„åŠ çš„éš”ç¦»æ ªã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä»dartå…¥å£ç‚¹æ–‡ä»¶å’Œå‡½æ•°åç§°è‡ªåŠ¨ç”Ÿæˆéš”ç¦»åç§°ã€‚

`l`åŒæ—¶æ˜¾ç¤ºä¸¤ä¸ªFlutteréš”ç¦»çš„åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹è¾“å‡ºï¼š

```
Connected views:
  main.dart$main-517591213 (isolates/517591213)
  main.dart$main-332962855 (isolates/332962855)
```

åˆ†ä¸¤æ­¥é™„åŠ åˆ°ç‰¹å®šçš„éš”ç¦»æ ªï¼š

1. åœ¨Dartæ¥æºä¸­å‘½åæ„Ÿå…´è¶£çš„Flutteræ ¹åˆ†ç¦»æ ªã€‚

```dart
// main.dart
import 'dart:ui' as ui;

void main() {
  ui.window.setIsolateDebugName("debug isolate");
  // ...
}
```

1. `flutter attach`ä½¿ç”¨è¯¥`--isolate-filter`é€‰é¡¹è¿è¡Œã€‚

```sh
$ flutter attach --isolate-filter='debug'
Waiting for a connection from Flutter...
Done.
Syncing files to device...      1.1s

ğŸ”¥  To hot reload changes while running, press "r". To hot restart (and rebuild state), press "R".
An Observatory debugger and profiler is available at: http://127.0.0.1:43343/
For a more detailed help message, press "h". To detach, press "d"; to quit, press "q".

Connected view:
  debug isolate (isolates/642101161)
```

æ‚¨å¯ä»¥æŸ¥çœ‹[`93573de`](https://github.com/flutter/flutter/commit/93573de2165c750fdeefcd2d620e2b8bd494fed6)æ›´è¯¦ç»†çš„ç¤ºä¾‹ã€‚



--------
å¼•ç”¨è‡ª[GitHub Flutter Wiki](https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps)
